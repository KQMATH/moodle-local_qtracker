define ("local_qtracker/questions_table",["exports","jquery","core/templates","core/ajax","core/url"],function(a,b,c,d,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=f(b);c=f(c);d=f(d);e=f(e);function f(a){return a&&a.__esModule?a:{default:a}}function g(a){return k(a)||j(a)||i(a)||h()}function h(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(a,b){if(!a)return;if("string"==typeof a)return l(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return l(a,b)}function j(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function k(a){if(Array.isArray(a))return l(a)}function l(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function m(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function n(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){m(h,d,e,f,g,"next",a)}function g(a){m(h,d,e,f,g,"throw",a)}f(void 0)})}}function o(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function p(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function q(a,b,c){if(b)p(a.prototype,b);if(c)p(a,c);return a}function r(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}var s=function(){function a(b){o(this,a);r(this,"courseid",null);this.courseid=b;this.init()}q(a,[{key:"init",value:function(){var a=n(regeneratorRuntime.mark(function a(){var d,e;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:d=!0;e={close:{key:"fa-times",title:"Close",alt:"Close pane",extraclasses:"",unmappedIcon:!1}};a.next=4;return c.default.render("local_qtracker/issues_pane",e).then(function(a,b){c.default.replaceNodeContents("#questions-table-sidebar",a,b)});case 4:window.showIssuesInPane=function(){var a=n(regeneratorRuntime.mark(function a(e){var f=this,h,i,j,k,l,m,o,p,q,r,s=arguments;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:h=1<s.length&&s[1]!==void 0?s[1]:null;(0,b.default)(".issues-pane-content .issues").empty();(0,b.default)(".issues-pane-content .loading").addClass("show");a.next=5;return this.loadQuestionData(e);case 5:i=a.sent;j=i.question;k=this.getQuestionEditUrl(this.courseid,e);l=(0,b.default)("<a></a>").attr("href",k).html(j.name+" #"+j.id);(0,b.default)(".issues-pane-title").html(l);a.next=12;return this.loadIssues(e,h);case 12:m=a.sent;o=m.issues;if(d)lol();p=g(new Set(o.map(function(a){return a.userid})));a.next=18;return this.loadUsersData(p);case 18:q=a.sent;r=[];o.forEach(function(){var a=n(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:c=q.find(function(a){var c=a.id;return c===b.userid});r.push(f.addIssueItem(b,c));case 2:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}());b.default.when.apply(b.default,r).done(function(){(0,b.default)(".issues-pane-content .loading").removeClass("show");b.default.each(arguments,function(a,b){c.default.appendNodeContents(".issues-pane-content .issues",b.html,b.js)})}).catch(function(a){console.error(a)});case 22:case"end":return a.stop();}}},a,this)}));return function(){return a.apply(this,arguments)}}().bind(this);window.closeIssuesPane=function(){if(!d)lol()};window.lol=function(){(0,b.default)(".qtracker-container").toggleClass("push-pane-over");(0,b.default)("#issues-pane").toggleClass("show");d=!d};case 7:case"end":return a.stop();}}},a,this)}));return function init(){return a.apply(this,arguments)}}()},{key:"addIssueItem",value:function(){var a=n(regeneratorRuntime.mark(function a(b,d){var f,g,h,i;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:f=e.default.relativeUrl("/local/qtracker/issue.php",{courseid:this.courseid,issueid:b.id});g=e.default.relativeUrl("/user/view.php",{course:this.courseid,id:d.id});h={issueurl:f,userurl:g,profileimageurl:d.profileimageurlsmall,fullname:d.fullname,timecreated:b.timecreated,title:b.title,description:b.description};i=b.state;h[i]=!0;return a.abrupt("return",c.default.render("local_qtracker/issues_pane_item",h).then(function(a,b){return{html:a,js:b}}));case 6:case"end":return a.stop();}}},a,this)}));return function addIssueItem(){return a.apply(this,arguments)}}()},{key:"loadIssues",value:function(){var a=n(regeneratorRuntime.mark(function a(b){var c,e,f,g=arguments;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:c=1<g.length&&g[1]!==void 0?g[1]:null;e=[{key:"questionid",value:b}];if(c){e.push({key:"state",value:c})}a.next=5;return d.default.call([{methodname:"local_qtracker_get_issues",args:{criteria:e}}])[0];case 5:f=a.sent;return a.abrupt("return",f);case 7:case"end":return a.stop();}}},a)}));return function loadIssues(){return a.apply(this,arguments)}}()},{key:"loadUsersData",value:function(){var a=n(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return d.default.call([{methodname:"core_user_get_users_by_field",args:{field:"id",values:b}}])[0];case 2:c=a.sent;return a.abrupt("return",c);case 4:case"end":return a.stop();}}},a)}));return function loadUsersData(){return a.apply(this,arguments)}}()},{key:"getQuestionEditUrl",value:function getQuestionEditUrl(a,b){var c=encodeURIComponent(location.pathname+location.search),d=e.default.relativeUrl("/question/question.php",{courseid:a,id:b,returnurl:c});return d}},{key:"decodeHTML",value:function decodeHTML(a){var b=new DOMParser().parseFromString(a,"text/html");return b.documentElement.textContent}},{key:"loadQuestionData",value:function(){var a=n(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return d.default.call([{methodname:"local_qtracker_get_question",args:{id:b}}])[0];case 2:c=a.sent;return a.abrupt("return",c);case 4:case"end":return a.stop();}}},a)}));return function loadQuestionData(){return a.apply(this,arguments)}}()}]);return a}();a.default=s;return a.default});
//# sourceMappingURL=questions_table.min.js.map
