define ("local_qtracker/questions_table_page",["exports","jquery","core/templates","core/ajax","core/url","local_qtracker/sidebar"],function(a,b,c,d,e,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=g(b);c=g(c);d=g(d);e=g(e);f=g(f);function g(a){return a&&a.__esModule?a:{default:a}}function h(a){return l(a)||k(a)||j(a)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function j(a,b){if(!a)return;if("string"==typeof a)return m(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return m(a,b)}function k(a){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(a))return Array.from(a)}function l(a){if(Array.isArray(a))return m(a)}function m(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function n(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function o(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){n(h,d,e,f,g,"next",a)}function g(a){n(h,d,e,f,g,"throw",a)}f(void 0)})}}function p(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function q(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function r(a,b,c){if(b)q(a.prototype,b);if(c)q(a,c);return a}function s(a,b,c){if(b in a){Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0})}else{a[b]=c}return a}var t=function(){function a(b){p(this,a);s(this,"courseid",null);this.courseid=b;this.sidebar=new f.default("#questions-table-sidebar",!1,"right",!1,"40%");this.init()}r(a,[{key:"init",value:function(){var a=o(regeneratorRuntime.mark(function a(){return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return this.sidebar.render();case 2:window.showIssuesInPane=function(){var a=o(regeneratorRuntime.mark(function a(c){var d=this,e,f,g,i,j,k,l,m,n,p,q=arguments;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:e=1<q.length&&q[1]!==void 0?q[1]:null;this.sidebar.empty();this.sidebar.setLoading(!0);a.next=5;return this.loadQuestionData(c);case 5:f=a.sent;g=f.question;i=this.getQuestionEditUrl(this.courseid,c);j=(0,b.default)("<a></a>").attr("href",i).html(g.name+" #"+g.id);this.sidebar.setTitle(j);this.sidebar.show();a.next=13;return this.loadIssues(c,e);case 13:k=a.sent;l=k.issues;m=h(new Set(l.map(function(a){return a.userid})));a.next=18;return this.loadUsersData(m);case 18:n=a.sent;p=[];l.forEach(function(){var a=o(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:c=n.find(function(a){var c=a.id;return c===b.userid});p.push(d.addIssueItem(b,c));case 2:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}());self=this;b.default.when.apply(b.default,p).done(function(){self.sidebar.setLoading(!1);b.default.each(arguments,function(a,b){self.sidebar.addTemplateItem(b.html,b.js)})}).catch(function(a){console.error(a)});case 23:case"end":return a.stop();}}},a,this)}));return function(){return a.apply(this,arguments)}}().bind(this);window.closeIssuesPane=function(){this.sidebar.hide()}.bind(this);window.toggleIssuesPane=function(){this.sidebar.togglePane()}.bind(this);case 5:case"end":return a.stop();}}},a,this)}));return function init(){return a.apply(this,arguments)}}()},{key:"addIssueItem",value:function(){var a=o(regeneratorRuntime.mark(function a(b,d){var f,g,h,i;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:f=e.default.relativeUrl("/local/qtracker/issue.php",{courseid:this.courseid,issueid:b.id});g=e.default.relativeUrl("/user/view.php",{course:this.courseid,id:d.id});h={issueurl:f,userurl:g,profileimageurl:d.profileimageurlsmall,fullname:d.fullname,timecreated:b.timecreated,id:b.id,title:b.title,description:b.description};i=b.state;h[i]=!0;return a.abrupt("return",c.default.render("local_qtracker/sidebar_item_issue",h).then(function(a,b){return{html:a,js:b}}));case 6:case"end":return a.stop();}}},a,this)}));return function addIssueItem(){return a.apply(this,arguments)}}()},{key:"loadIssues",value:function(){var a=o(regeneratorRuntime.mark(function a(b){var c,e,f,g=arguments;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:c=1<g.length&&g[1]!==void 0?g[1]:null;e=[{key:"questionid",value:b}];if(c){e.push({key:"state",value:c})}a.next=5;return d.default.call([{methodname:"local_qtracker_get_issues",args:{criteria:e}}])[0];case 5:f=a.sent;return a.abrupt("return",f);case 7:case"end":return a.stop();}}},a)}));return function loadIssues(){return a.apply(this,arguments)}}()},{key:"loadUsersData",value:function(){var a=o(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return d.default.call([{methodname:"core_user_get_users_by_field",args:{field:"id",values:b}}])[0];case 2:c=a.sent;return a.abrupt("return",c);case 4:case"end":return a.stop();}}},a)}));return function loadUsersData(){return a.apply(this,arguments)}}()},{key:"getQuestionEditUrl",value:function getQuestionEditUrl(a,b){var c=encodeURIComponent(location.pathname+location.search),d=e.default.relativeUrl("/question/question.php",{courseid:a,id:b,returnurl:c});return d}},{key:"decodeHTML",value:function decodeHTML(a){var b=new DOMParser().parseFromString(a,"text/html");return b.documentElement.textContent}},{key:"loadQuestionData",value:function(){var a=o(regeneratorRuntime.mark(function a(b){var c;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return d.default.call([{methodname:"local_qtracker_get_question",args:{id:b}}])[0];case 2:c=a.sent;return a.abrupt("return",c);case 4:case"end":return a.stop();}}},a)}));return function loadQuestionData(){return a.apply(this,arguments)}}()}]);return a}();a.default=t;return a.default});
//# sourceMappingURL=questions_table_page.min.js.map
