{"version":3,"file":"sidebar.min.js","sources":["../src/sidebar.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manager for managing a sidebar.\n *\n * @module     local_qtracker/Sidebar\n * @class      Sidebar\n * @package    local_qtracker\n * @author     Andr√© Storhaug <andr3.storhaug@gmail.com>\n * @copyright  2021 NTNU\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Templates from 'core/templates';\n\n/**\n * Constructor\n * @constructor\n * @param {String} selector used to find triggers for the new group modal.\n * @param {int} contextid\n *\n * Each call to init gets it's own instance of this class.\n */\nclass Sidebar {\n    hidden = null;\n    loading = null;\n    width = null;\n    margin = null;\n    container = null;\n    closable = null;\n    options = null;\n\n    constructor(container, show = false, side = 'right', loading = false, width = '40%', margin = '0px', closable = true, options = []) {\n        this.container = $(container); // Container element\n        this.hidden = !show;\n        this.visible = show;\n        this.side = side;\n        this.loading = loading;\n        this.width = width;\n        this.margin = margin;\n\n        this.closable = closable;\n        this.options = options;\n\n        this.mql = window.matchMedia('(min-width: 768px)');\n        this.mql.addEventListener('change', this.screenTest.bind(this));\n\n        this.render = this.render.bind(this);\n    }\n\n    screenTest(e) {\n        if (!this.visible) {\n            return;\n        }\n        if (e.matches) {\n            /* the viewport is 768px pixels wide or more */\n            //$('#qtracker-sidebar').css('width', 'calc(' + this.width + ' - -1.25rem)');\n            //$('.qtracker-push-pane-over').css('padding-' + this.getSide(), 'calc(' + this.width + ' - -' + this.margin + ')');\n        } else {\n            /* the viewport is more than 768px pixels wide or less */\n            //$('#qtracker-sidebar').css('width', '100%');\n            //$('.qtracker-push-pane-over').css('padding-' + this.getSide(), '0');\n        }\n    }\n\n    async render() {\n        let self = this;\n\n        let context = {};\n        if (this.closable) {\n            context.close = {\n                \"key\": \"fa-times\",\n                \"title\": \"Close\",\n                \"alt\": \"Close pane\",\n                \"extraclasses\": \"\",\n                \"unmappedIcon\": false\n            };\n        }\n        if (this.options.length > 0) {\n            context.options = {\n                \"trigger\": {\n                    \"key\": \"fa-filter\",\n                    \"title\": \"Options\",\n                    \"alt\": \"Show options\",\n                    \"extraclasses\": \"\",\n                    \"unmappedIcon\": false\n                },\n                \"header\": false,\n                \"items\": self.options,\n            };\n        }\n\n        //let self = this;\n        await Templates.render('local_qtracker/sidebar', context).then((html, js) => {\n            Templates.appendNodeContents(this.container, html, js);\n            this.setVisibility(!this.hidden);\n            this.setLoading(this.loading);\n            this.setSide(this.side);\n            this.screenTest(this.mql)\n        });\n    }\n\n    getSide() {\n        return this.side;\n    }\n\n    getOppositeSide() {\n        return this.side == 'left' ? 'right' : 'left';\n    }\n\n    /**\n     *\n     * @param {*} width The sidebar width\n     * @param {*} width2 The existing content width\n     */\n    setWidth(width, width2) {\n        this.width = width;\n        this.width2 = width2;\n\n        this.screenTest(this.mql);\n    }\n\n    isMobileWidth() {\n        return !this.mql.matches;\n    }\n    setSide(side) {\n        if (side == 'right') {\n            $('#qtracker-sidebar').addClass('qtracker-sidebar-right');\n            $('#qtracker-sidebar').removeClass('qtracker-sidebar-left');\n        } else if (side == 'left') {\n            $('#qtracker-sidebar').addClass('qtracker-sidebar-left');\n            $('#qtracker-sidebar').removeClass('qtracker-sidebar-right');\n        }\n    }\n\n    setTitle(html) {\n        $('.qtracker-sidebar-title').html(html);\n    }\n\n    setLoading(show = true) {\n        if (show) {\n            $('.qtracker-sidebar-content .loading').addClass(\"show\");\n            this.loading = true;\n        } else {\n            $('.qtracker-sidebar-content .loading').removeClass(\"show\");\n            this.loading = false;\n        }\n    }\n\n    empty() {\n        $('.qtracker-sidebar-content .qtracker-items').empty();\n    }\n\n    addTemplateItem(html, js) {\n        Templates.appendNodeContents('.qtracker-sidebar-content .qtracker-items', html, js);\n    }\n\n    getItems() {\n        return $('.qtracker-sidebar-content .qtracker-items').children();\n    }\n\n    getContainer() {\n        return this.container;\n    }\n\n    hide() {\n        if (!this.hidden) {\n            this.setVisibility(false);\n        }\n    }\n\n    show() {\n        if (this.hidden) {\n            this.setVisibility(true);\n        }\n    }\n\n    setVisibility(show = true) {\n        if (show) {\n            //$('.qtracker-push-pane-over').css('padding-' + this.getSide(), 'calc(' + this.width + ' - -' + this.margin + ')');\n            $('#qtracker-sidebar').addClass('show');\n            $('#page').addClass('qtracker-show-drawer-' + this.side);\n            this.screenTest(this.mql);\n        } else {\n            //$('.qtracker-push-pane-over').css('padding-' + this.getSide(), '0');\n            $('#qtracker-sidebar').removeClass('show');\n            $('#page').removeClass('qtracker-show-drawer-' + this.side);\n        }\n        this.hidden = !show;\n        this.visible = show;\n    }\n\n    togglePane() {\n        //$('.qtracker-container').toggleClass('qtracker-push-pane-over');\n        $('#qtracker-sidebar').toggleClass(\"show\");\n        this.hidden = !this.hidden;\n    }\n\n    decodeHTML(html) {\n        var doc = new DOMParser().parseFromString(html, \"text/html\");\n        return doc.documentElement.textContent;\n    }\n}\n\nexport default Sidebar;\n"],"names":["constructor","container","show","side","loading","width","margin","closable","options","hidden","visible","mql","window","matchMedia","addEventListener","this","screenTest","bind","render","e","matches","self","context","close","length","Templates","then","html","js","appendNodeContents","setVisibility","setLoading","setSide","getSide","getOppositeSide","setWidth","width2","isMobileWidth","addClass","removeClass","setTitle","empty","addTemplateItem","getItems","children","getContainer","hide","togglePane","toggleClass","decodeHTML","DOMParser","parseFromString","documentElement","textContent"],"mappings":"4hBA6CIA,YAAYC,eAAWC,6DAAcC,4DAAO,QAASC,gEAAiBC,6DAAQ,MAAOC,8DAAS,MAAOC,oEAAiBC,+DAAU,iCARvH,qCACC,mCACF,oCACC,uCACG,sCACD,qCACD,WAGDP,WAAY,mBAAEA,gBACdQ,QAAUP,UACVQ,QAAUR,UACVC,KAAOA,UACPC,QAAUA,aACVC,MAAQA,WACRC,OAASA,YAETC,SAAWA,cACXC,QAAUA,aAEVG,IAAMC,OAAOC,WAAW,2BACxBF,IAAIG,iBAAiB,SAAUC,KAAKC,WAAWC,KAAKF,YAEpDG,OAASH,KAAKG,OAAOD,KAAKF,MAGnCC,WAAWG,GACFJ,KAAKL,SAGNS,EAAEC,2BAYFC,KAAON,KAEPO,QAAU,GACVP,KAAKR,WACLe,QAAQC,MAAQ,KACL,iBACE,YACF,0BACS,iBACA,IAGpBR,KAAKP,QAAQgB,OAAS,IACtBF,QAAQd,QAAU,SACH,KACA,kBACE,cACF,4BACS,iBACA,WAEV,QACDa,KAAKb,gBAKhBiB,mBAAUP,OAAO,yBAA0BI,SAASI,MAAK,CAACC,KAAMC,yBACxDC,mBAAmBd,KAAKd,UAAW0B,KAAMC,SAC9CE,eAAef,KAAKN,aACpBsB,WAAWhB,KAAKX,cAChB4B,QAAQjB,KAAKZ,WACba,WAAWD,KAAKJ,QAI7BsB,iBACWlB,KAAKZ,KAGhB+B,wBACwB,QAAbnB,KAAKZ,KAAiB,QAAU,OAQ3CgC,SAAS9B,MAAO+B,aACP/B,MAAQA,WACR+B,OAASA,YAETpB,WAAWD,KAAKJ,KAGzB0B,uBACYtB,KAAKJ,IAAIS,QAErBY,QAAQ7B,MACQ,SAARA,0BACE,qBAAqBmC,SAAS,8CAC9B,qBAAqBC,YAAY,0BACpB,QAARpC,2BACL,qBAAqBmC,SAAS,6CAC9B,qBAAqBC,YAAY,2BAI3CC,SAASb,0BACH,2BAA2BA,KAAKA,MAGtCI,6FAEU,sCAAsCO,SAAS,aAC5ClC,SAAU,wBAEb,sCAAsCmC,YAAY,aAC/CnC,SAAU,GAIvBqC,4BACM,6CAA6CA,QAGnDC,gBAAgBf,KAAMC,uBACRC,mBAAmB,4CAA6CF,KAAMC,IAGpFe,kBACW,mBAAE,6CAA6CC,WAG1DC,sBACW9B,KAAKd,UAGhB6C,OACS/B,KAAKN,aACDqB,eAAc,GAI3B5B,OACQa,KAAKN,aACAqB,eAAc,GAI3BA,oBAAc5B,gEACNA,0BAEE,qBAAqBoC,SAAS,4BAC9B,SAASA,SAAS,wBAA0BvB,KAAKZ,WAC9Ca,WAAWD,KAAKJ,2BAGnB,qBAAqB4B,YAAY,4BACjC,SAASA,YAAY,wBAA0BxB,KAAKZ,YAErDM,QAAUP,UACVQ,QAAUR,KAGnB6C,iCAEM,qBAAqBC,YAAY,aAC9BvC,QAAUM,KAAKN,OAGxBwC,WAAWtB,aACG,IAAIuB,WAAYC,gBAAgBxB,KAAM,aACrCyB,gBAAgBC"}