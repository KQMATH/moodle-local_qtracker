{"version":3,"sources":["../src/dropdown.js"],"names":["SELECTORS","DROPDOWN","SEARCH","ITEM","Dropdown","root","search","Map","dropdown","find","render","renderItems","bind","registerEventListeners","getDropdown","on","e","element","currentTarget","hasClass","clickEvent","$","Event","DropdownEvents","click","getRoot","trigger","isDefaultPrevented","preventDefault","registerSearchListener","str","target","val","searchEvent","length","isSearching","activeItems","key","active","item","getItems","get","set","delete","context","Templates","then","html","js","replaceNodeContents","elements","items","getActiveItems","size","addClass","attr","prop","push","forEach","isActiveItem","empty","generateItems","append","Array","prototype","concat","has","criteria","startsWith","id","parseInt","substr","value","issuesResponse","issues","setItems","show","loading","removeClass","remove","appendNodeContents","children"],"mappings":"sPAyBA,OACA,OAEA,O,uzBAGIA,CAAAA,CAAS,CAAG,CACZC,QAAQ,CAAE,4BADE,CAEZC,MAAM,CAAE,wBAFI,CAGZC,IAAI,CAAE,wBAHM,C,CAcVC,C,YAOF,WAAYC,CAAZ,CAAiC,IAAfC,CAAAA,CAAe,sFANvB,IAMuB,gBAL1B,IAK0B,iBAJzB,GAAIC,CAAAA,GAIqB,uBAHnB,GAAIA,CAAAA,GAGe,2BAC7B,KAAKF,IAAL,CAAY,cAAEA,CAAF,CAAZ,CACA,KAAKG,QAAL,CAAgB,KAAKH,IAAL,CAAUI,IAAV,CAAeT,CAAS,CAACC,QAAzB,CAAhB,CACA,KAAKK,MAAL,CAAcA,CAAd,CAEA,KAAKI,MAAL,CAAc,KAAKC,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAAd,CACA,KAAKC,sBAAL,CAA8B,KAAKA,sBAAL,CAA4BD,IAA5B,CAAiC,IAAjC,CAA9B,CAEA,GAAI,KAAKN,MAAT,CAAiB,CACb,KAAKO,sBAAL,EACH,CACJ,C,oDAUa,CACV,MAAO,MAAKL,QACf,C,yCAQS,CACN,MAAO,MAAKH,IACf,C,uEAOwB,CAErB,KAAKS,WAAL,GAAmBC,EAAnB,CAAsB,OAAtB,CAA+Bf,CAAS,CAACG,IAAzC,CAA+C,SAAUa,CAAV,CAAa,CACxD,GAAIC,CAAAA,CAAO,CAAG,cAAED,CAAC,CAACE,aAAJ,CAAd,CACA,GAAID,CAAO,CAACE,QAAR,CAAiB,UAAjB,CAAJ,CAAkC,CAC9B,MACH,CACD,GAAIC,CAAAA,CAAU,CAAGC,UAAEC,KAAF,CAAQC,UAAeC,KAAvB,CAAjB,CACA,KAAKC,OAAL,GAAeC,OAAf,CAAuBN,CAAvB,CAAmC,CAACH,CAAD,CAAnC,EAEA,GAAI,CAACG,CAAU,CAACO,kBAAX,EAAL,CAAsC,CAClCX,CAAC,CAACY,cAAF,EACH,CACJ,CAX8C,CAW7ChB,IAX6C,CAWxC,IAXwC,CAA/C,EAaA,KAAKiB,sBAAL,EACH,C,uEAQwB,CAErB,KAAKf,WAAL,GAAmBL,IAAnB,CAAwBT,CAAS,CAACE,MAAlC,EAA0Ca,EAA1C,CAA6C,OAA7C,CAAsD,SAAUC,CAAV,CAAa,IAE3Dc,CAAAA,CAAG,CAAG,cAAEd,CAAC,CAACe,MAAJ,EAAYC,GAAZ,EAFqD,CAG3DC,CAAW,CAAGZ,UAAEC,KAAF,CAAQC,UAAejB,MAAvB,CAA+BwB,CAA/B,CAH6C,CAI/D,KAAKL,OAAL,GAAeC,OAAf,CAAuBO,CAAvB,CAAoC,CAACH,CAAD,CAApC,EAEA,GAAI,CAACG,CAAW,CAACN,kBAAZ,EAAL,CAAuC,CACnCX,CAAC,CAACY,cAAF,GACA,GAAiB,CAAb,CAAAE,CAAG,CAACI,MAAR,CAAoB,CAChB,KAAKC,WAAL,GACH,CAFD,IAEO,CACH,KAAKA,WAAL,GACH,CACD,KAAKxB,WAAL,EACH,CACJ,CAfqD,CAepDC,IAfoD,CAe/C,IAf+C,CAAtD,CAgBH,C,uDAGgB,CAEb,MAAO,MAAKwB,WACf,C,oDAEaC,C,CAAoB,IAAfC,CAAAA,CAAe,2DAC9B,GAAIA,CAAJ,CAAY,CACR,GAAIC,CAAAA,CAAI,CAAG,KAAKC,QAAL,GAAgBC,GAAhB,CAAoBJ,CAApB,CAAX,CACA,KAAKD,WAAL,CAAiBM,GAAjB,CAAqBL,CAArB,CAA0BE,CAA1B,CACH,CAHD,IAGO,CACH,KAAKH,WAAL,CAAiBO,MAAjB,CAAwBN,CAAxB,CACH,CACJ,C,qCAEO,CACJ,KAAKF,WAAL,IACA,KAAKrB,WAAL,GAAmBL,IAAnB,CAAwBT,CAAS,CAACE,MAAlC,EAA0C8B,GAA1C,CAA8C,EAA9C,EACA,KAAKrB,WAAL,EACH,C,4KAGOiC,C,CAAU,CACVlB,OAAO,CAAE,CACL,IAAO,UADF,CAEL,MAAS,OAFJ,CAGL,IAAO,YAHF,CAIL,aAAgB,EAJX,CAKL,eALK,CADC,C,gBAURmB,WAAUnC,MAAV,CAAiB,yBAAjB,CAA4CkC,CAA5C,EAAqDE,IAArD,CAA0D,SAACC,CAAD,CAAOC,CAAP,CAAc,CAC1EH,UAAUI,mBAAV,CAA8B,CAAI,CAACnC,WAAL,EAA9B,CAAkDiC,CAAlD,CAAwDC,CAAxD,CACH,CAFK,C,8RAMFE,C,CAAW,E,CACXC,C,CAAQ,KAAKhB,WAAL,CAAmB,KAAKK,QAAL,EAAnB,CAAqC,KAAKY,cAAL,E,MAC9B,CAAf,GAAAD,CAAK,CAACE,I,wBACQ,cAAE,aAAF,EACTC,QADS,CACA,wBADA,EAETC,IAFS,CAEJ,aAFI,CAEW,MAFX,C,gBAGE,iBAAU,SAAV,CAAqB,gBAArB,C,oBAHZtC,C,MAGC8B,I,iBACAS,I,CAAK,W,EACVN,CAAQ,CAACO,IAAT,CAAcxC,CAAd,E,wBAGAkC,CAAK,CAACO,OAAN,CAAc,SAACX,CAAD,CAAOV,CAAP,CAAe,CACzB,GAAIpB,CAAAA,CAAO,CAAG,cAAE,aAAF,EACTqC,QADS,CACA,eADA,EAETA,QAFS,CAEA,UAAM,CACZ,GAAI,CAAI,CAACK,YAAL,CAAkBtB,CAAlB,CAAJ,CAA4B,CACxB,MAAO,QACV,CACJ,CANS,EAOTkB,IAPS,CAOJ,YAPI,CAOUlB,CAPV,EAQTkB,IARS,CAQJ,aARI,CAQW,MARX,EASTR,IATS,CASJA,CATI,EASES,IATF,CASO,WATP,CAAd,CAUAN,CAAQ,CAACO,IAAT,CAAcxC,CAAd,CACH,CAZD,E,iCAcGiC,C,+RAIP,KAAKU,KAAL,G,eACqB,MAAKC,aAAL,E,QAAjBX,C,QACJ,KAAKpC,WAAL,GAAmBgD,MAAnB,CAA0BZ,CAA1B,E,0JASKC,C,CAAuB,YAAhBb,CAAgB,2DAC5B,GAAIA,CAAJ,CAAY,CACR,KAAKF,WAAL,CAAmB,GAAI7B,CAAAA,GAAvB,CACA4C,CAAK,CAACO,OAAN,CAAc,SAAAnB,CAAI,QAAI,CAAA,CAAI,CAACH,WAAL,CAAiBM,GAAjB,CAAqBH,CAAI,CAAC,CAAD,CAAzB,CAA8BA,CAAI,CAAC,CAAD,CAAlC,CAAJ,CAAlB,CACH,CAHD,IAGO,CACH,KAAKY,KAAL,CAAa,GAAI5C,CAAAA,GAAjB,CACA4C,CAAK,CAACO,OAAN,CAAc,SAAAnB,CAAI,QAAI,CAAA,CAAI,CAACY,KAAL,CAAWT,GAAX,CAAeH,CAAI,CAAC,CAAD,CAAnB,CAAwBA,CAAI,CAAC,CAAD,CAA5B,CAAJ,CAAlB,CACH,CACJ,C,2CAEU,CACP,MAAO,MAAKY,KACf,C,iDAEa,CACV,MAAOY,CAAAA,KAAK,CAACC,SAAN,CAAgBC,MAAhB,CAAuB,KAAKd,KAA5B,CAAmC,KAAKC,cAAL,EAAnC,CACV,C,kDAEYf,C,CAAK,CACd,MAAO,MAAKe,cAAL,GAAsBc,GAAtB,CAA0B7B,CAA1B,CACV,C,4EAEYP,C,+FACT,GAAiB,CAAb,CAAAA,CAAG,CAACI,MAAR,CAAoB,CAChB,KAAKC,WAAL,GACH,CAFD,IAEO,CACH,KAAKA,WAAL,GACH,CAEGgC,C,CAAW,E,CACf,GAAIrC,CAAG,CAACsC,UAAJ,CAAe,GAAf,CAAJ,CAAyB,CACjBC,CADiB,CACZC,QAAQ,CAACxC,CAAG,CAACyC,MAAJ,CAAW,CAAX,CAAD,CADI,CAErBJ,CAAQ,CAACV,IAAT,CAAc,CAAEpB,GAAG,CAAE,IAAP,CAAamC,KAAK,CAAEH,CAApB,CAAd,CACH,CAHD,IAGO,CACH,GAAiB,CAAb,CAAAvC,CAAG,CAACI,MAAR,CAAoBJ,CAAG,EAAI,GAAP,CACpBqC,CAAQ,CAACV,IAAT,CAAc,CAAEpB,GAAG,CAAE,OAAP,CAAgBmC,KAAK,CAAE1C,CAAvB,CAAd,CACH,C,eAE0B,qBAAeqC,CAAf,C,QAAvBM,C,QACAC,C,CAASD,CAAc,CAACC,M,CAC5B,KAAKC,QAAL,CAAcD,CAAd,E,yBACOA,C,uJAGF3B,C,CAAM,CACX,cAAE,yBAAF,EAA6BA,IAA7B,CAAkCA,CAAlC,CACH,C,+CAEuB,IAAb6B,CAAAA,CAAa,2DACpB,GAAIA,CAAJ,CAAU,CACN,cAAE,oCAAF,EAAwCtB,QAAxC,CAAiD,MAAjD,EACA,KAAKuB,OAAL,GACH,CAHD,IAGO,CACH,cAAE,oCAAF,EAAwCC,WAAxC,CAAoD,MAApD,EACA,KAAKD,OAAL,GACH,CACJ,C,qCAEO,CACJ,KAAK/D,WAAL,GAAmBL,IAAnB,CAAwBT,CAAS,CAACG,IAAlC,EAAwC4E,MAAxC,EACH,C,wDAEehC,C,CAAMC,C,CAAI,CACtBH,UAAUmC,kBAAV,CAA6B,2CAA7B,CAA0EjC,CAA1E,CAAgFC,CAAhF,CACH,C,iDAEa,CACV,MAAO,cAAE,2CAAF,EAA+CiC,QAA/C,EACV,C,0BAIU7E,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Manager for managing table of questions with issues.\n *\n * @module     local_qtracker/Dropdown\n * @class      Dropdown\n * @package    local_qtracker\n * @author     Andr√© Storhaug <andr3.storhaug@gmail.com>\n * @copyright  2021 NTNU\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Templates from 'core/templates';\nimport { get_string as getString } from 'core/str';\nimport DropdownEvents from 'local_qtracker/dropdown_events';\nimport { loadIssuesData } from 'local_qtracker/api_helpers';\n\nvar SELECTORS = {\n    DROPDOWN: '[data-region=\"dropdown\"]',\n    SEARCH: 'input[type=\"search\"]',\n    ITEM: '[data-region=\"item\"]',\n};\n\n/**\n * Constructor\n * @constructor\n * @param {String} selector used to find triggers for the new group modal.\n * @param {int} contextid\n *\n * Each call to init gets it's own instance of this class.\n */\nclass Dropdown {\n    loading = null;\n    root = null;\n    items = new Map();\n    activeItems = new Map();\n    isSearching = false;\n\n    constructor(root, search = true) {\n        this.root = $(root); // Root element dropdown-menu\n        this.dropdown = this.root.find(SELECTORS.DROPDOWN);\n        this.search = search;\n\n        this.render = this.renderItems.bind(this);\n        this.registerEventListeners = this.registerEventListeners.bind(this);\n\n        if (this.search) {\n            this.registerEventListeners();\n        }\n    }\n\n\n\n    /**\n     * Get the dropdown element of this dropdown.\n     *\n     * @method getDropdown\n     * @return {object} jQuery object\n     */\n    getDropdown() {\n        return this.dropdown;\n    };\n\n    /**\n     * Get the dropdown element of this dropdown.\n     *\n     * @method getDropdown\n     * @return {object} jQuery object\n     */\n    getRoot() {\n        return this.root;\n    };\n\n    /**\n     * Set up all of the event handling for the modal.\n     *\n     * @method registerEventListeners\n     */\n    registerEventListeners() {\n        // Handle the clicking of an item.\n        this.getDropdown().on('click', SELECTORS.ITEM, function (e) {\n            let element = $(e.currentTarget);\n            if (element.hasClass(\"disabled\")) {\n                return;\n            }\n            var clickEvent = $.Event(DropdownEvents.click);\n            this.getRoot().trigger(clickEvent, [element]);\n\n            if (!clickEvent.isDefaultPrevented()) {\n                e.preventDefault();\n            }\n        }.bind(this));\n\n        this.registerSearchListener();\n    }\n\n\n    /**\n     * Register a listener to close the dialogue when the save button is pressed.\n     *\n     * @method registerSearch\n     */\n    registerSearchListener() {\n\n        this.getDropdown().find(SELECTORS.SEARCH).on('input', function (e) {\n\n            let str = $(e.target).val();\n            var searchEvent = $.Event(DropdownEvents.search, str);\n            this.getRoot().trigger(searchEvent, [str]);\n\n            if (!searchEvent.isDefaultPrevented()) {\n                e.preventDefault();\n                if (str.length > 0) {\n                    this.isSearching = true;\n                } else {\n                    this.isSearching = false;\n                }\n                this.renderItems();\n            }\n        }.bind(this));\n    };\n\n\n    getActiveItems() {\n\n        return this.activeItems;\n    }\n\n    setItemStatus(key, active = true) {\n        if (active) {\n            let item = this.getItems().get(key);\n            this.activeItems.set(key, item);\n        } else {\n            this.activeItems.delete(key);\n        }\n    }\n\n    reset() {\n        this.isSearching = false;\n        this.getDropdown().find(SELECTORS.SEARCH).val(\"\");\n        this.renderItems()\n    }\n\n    async render() {\n        let context = {\n            trigger: {\n                \"key\": \"fa-times\",\n                \"title\": \"Close\",\n                \"alt\": \"Close pane\",\n                \"extraclasses\": \"\",\n                \"unmappedIcon\": false\n            }\n        };\n        //let self = this;\n        await Templates.render('local_qtracker/dropdown', context).then((html, js) => {\n            Templates.replaceNodeContents(this.getDropdown(), html, js);\n        });\n    }\n\n    async generateItems() {\n        let elements = [];\n        let items = this.isSearching ? this.getItems() : this.getActiveItems();\n        if (items.size === 0) {\n            let element = $('<div></div>')\n                .addClass(\"dropdown-item disabled\")\n                .attr(\"data-region\", 'item')\n                .html(await getString('noitems', 'local_qtracker'))\n                .prop('outerHTML');\n            elements.push(element)\n        } else {\n            // map ;; index(id), html\n            items.forEach((html, key) => {\n                let element = $('<div></div>')\n                    .addClass(\"dropdown-item\")\n                    .addClass(() => {\n                        if (this.isActiveItem(key)) {\n                            return \"active\";\n                        }\n                    })\n                    .attr(\"data-value\", key)\n                    .attr(\"data-region\", 'item')\n                    .html(html).prop('outerHTML');\n                elements.push(element)\n            });\n        }\n        return elements;\n    }\n\n    async renderItems() {\n        this.empty();\n        let elements = await this.generateItems();\n        this.getDropdown().append(elements);\n        //<a class=\"dropdown-item\" data-value={{value}} href=\"#\">{{{text}}}</a>\n    }\n\n    /**\n     *\n     * @param {*} items tuples [id, html]\n     * @param {*} active\n     */\n    setItems(items, active = false) {\n        if (active) {\n            this.activeItems = new Map();\n            items.forEach(item => this.activeItems.set(item[0], item[1]));\n        } else {\n            this.items = new Map();\n            items.forEach(item => this.items.set(item[0], item[1]));\n        }\n    }\n\n    getItems() {\n        return this.items;\n    }\n\n    getAllItems() {\n        return Array.prototype.concat(this.items, this.getActiveItems());\n    }\n\n    isActiveItem(key) {\n        return this.getActiveItems().has(key);\n    }\n\n    async search(str) {\n        if (str.length > 0) {\n            this.isSearching = true;\n        } else {\n            this.isSearching = false;\n        }\n\n        let criteria = [];\n        if (str.startsWith('#')) {\n            let id = parseInt(str.substr(1));\n            criteria.push({ key: 'id', value: id });\n        } else {\n            if (str.length > 2) str += \"%\"\n            criteria.push({ key: 'title', value: str });\n        }\n\n        let issuesResponse = await loadIssuesData(criteria);\n        let issues = issuesResponse.issues;\n        this.setItems(issues);\n        return issues;\n    }\n\n    setTitle(html) {\n        $('.qtracker-sidebar-title').html(html);\n    }\n\n    setLoading(show = true) {\n        if (show) {\n            $('.qtracker-sidebar-content .loading').addClass(\"show\");\n            this.loading = true;\n        } else {\n            $('.qtracker-sidebar-content .loading').removeClass(\"show\");\n            this.loading = false;\n        }\n    }\n\n    empty() {\n        this.getDropdown().find(SELECTORS.ITEM).remove();\n    }\n\n    addTemplateItem(html, js) {\n        Templates.appendNodeContents('.qtracker-sidebar-content .qtracker-items', html, js);\n    }\n\n    getElements() {\n        return $('.qtracker-sidebar-content .qtracker-items').children();\n    }\n\n}\n\nexport default Dropdown;\n"],"file":"dropdown.min.js"}